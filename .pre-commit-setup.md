# Pre-commit Hook Setup

This project uses pre-commit hooks to ensure code quality before commits.

## Quick Setup

```bash
# 1. Install dependencies (if not already done)
uv sync

# 2. Install the git hooks
uv run pre-commit install

# 3. (Optional) Run on all files to check everything
uv run pre-commit run --all-files
```

## What Gets Checked

Every time you commit, the following checks run automatically:

### 1. **Tests** (pytest)
- All tests must pass
- Coverage must be ≥90%
- Runs on every commit

### 2. **Code Formatting** (ruff)
- Auto-formats Python code
- Fixes import sorting
- Enforces consistent style

### 3. **Code Quality Checks**
- Removes trailing whitespace
- Ensures files end with newline
- Validates YAML and TOML syntax
- Checks for large files
- Detects merge conflicts

## Usage

### Normal workflow
Just commit as usual:
```bash
git add .
git commit -m "Your message"
```

The hooks will run automatically. If they fail:
- **Tests fail**: Fix the failing tests
- **Formatting issues**: Ruff will auto-fix most issues, just re-add the files
- **Other issues**: Fix them and try again

### Bypass hooks (emergency only)
```bash
git commit --no-verify -m "Emergency fix"
```

⚠️ **Not recommended** - only use when absolutely necessary (e.g., hotfix in production)

### Run hooks manually
```bash
# Run all hooks on staged files
uv run pre-commit run

# Run all hooks on all files
uv run pre-commit run --all-files

# Run specific hook
uv run pre-commit run pytest
uv run pre-commit run ruff
```

### Update hooks
```bash
uv run pre-commit autoupdate
```

## Troubleshooting

### "command not found: pre-commit"
Make sure you've run `uv sync` to install dependencies.

### Tests are slow
The test suite runs on every commit. If it's too slow:
1. Consider running only fast tests in pre-commit
2. Use `git commit --no-verify` occasionally (sparingly)
3. Optimize slow tests

### Hooks keep failing
```bash
# See what's wrong
uv run pre-commit run --all-files --verbose

# Clean and reinstall
uv run pre-commit clean
uv run pre-commit install
```

## Configuration Files

- `.pre-commit-config.yaml` - Hook configuration
- `pyproject.toml` - Ruff and pytest settings
- `.gitignore` - Excludes hook cache

## CI/CD Integration

The same checks run in GitHub Actions on every push/PR, so passing pre-commit hooks means your CI is likely to pass too.
